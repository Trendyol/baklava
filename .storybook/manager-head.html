<style id="storybook-sidebar-theme">
  /* Force sidebar background to update */
  [data-side="left"] {
    transition: background-color 0.3s ease !important;
  }
</style>

<script>
console.log('ðŸš€ manager-head.html LOADED!');
(function() {
  'use strict';
  console.log('ðŸŽ¨ Theme script starting...');
  
  // CSS for light and dark themes
  const lightCSS = `
    /* Light theme styles */
    body,
    body *,
    #storybook-root,
    #storybook-root *,
    [data-side="left"],
    [data-side="left"] *,
    nav[role="navigation"],
    nav[role="navigation"] *,
    .sidebar-container,
    .sidebar-container *,
    .os-host,
    .os-host *,
    .os-padding,
    .os-padding * {
      background: #ffffff !important;
      background-color: #ffffff !important;
      background-image: none !important;
    }
    
    /* Remove any overlays or pseudo-elements */
    [data-side="left"]::before,
    [data-side="left"]::after,
    nav[role="navigation"]::before,
    nav[role="navigation"]::after {
      display: none !important;
    }
  `;
  
  const darkCSS = `
    /* Dark theme styles - PURE BLACK background */
    body,
    body > *,
    #storybook-root,
    #storybook-root > *,
    [data-side="left"],
    [data-side="left"] *,
    nav[role="navigation"],
    nav[role="navigation"] *,
    .sidebar-container,
    .sidebar-container *,
    .os-host,
    .os-host *,
    .os-padding,
    .os-padding *,
    aside,
    aside * {
      background: #000000 !important;
      background-color: #000000 !important;
      background-image: none !important;
      opacity: 1 !important;
    }
    
    /* Remove any overlays, gradients or pseudo-elements */
    [data-side="left"]::before,
    [data-side="left"]::after,
    nav[role="navigation"]::before,
    nav[role="navigation"]::after,
    aside::before,
    aside::after {
      display: none !important;
      background: transparent !important;
    }
    
    /* Force text color to be visible */
    [data-side="left"] *,
    nav[role="navigation"] *,
    aside * {
      color: #E6E9F0 !important;
    }
    
    /* Links and interactive elements */
    [data-side="left"] a,
    [data-side="left"] button,
    nav[role="navigation"] a,
    nav[role="navigation"] button {
      color: #E6E9F0 !important;
    }
    
    [data-side="left"] a:hover,
    [data-side="left"] button:hover,
    nav[role="navigation"] a:hover,
    nav[role="navigation"] button:hover {
      background: #1a1a1a !important;
      color: #ffffff !important;
    }
  `;
  
  let styleElement = null;
  
  function applyThemeCSS(theme) {
    console.log('Manager-head: Applying CSS for theme:', theme);
    
    // Remove existing style if any
    if (styleElement) {
      styleElement.remove();
    }
    
    // Create new style element
    styleElement = document.createElement('style');
    styleElement.id = 'dynamic-sidebar-theme';
    styleElement.textContent = theme === 'dark' ? darkCSS : lightCSS;
    document.head.appendChild(styleElement);
    
    // Also set data attribute on body
    document.body.setAttribute('data-theme', theme);
    document.documentElement.setAttribute('data-theme', theme);
    
    // Debug: Check sidebar background and find all potential sidebar elements
    setTimeout(() => {
      console.log('=== DEBUG: Searching for sidebar elements ===');
      
      // Try multiple selectors
      const selectors = [
        '[data-side="left"]',
        'nav[role="navigation"]',
        'aside',
        '[class*="sidebar"]',
        '[class*="Sidebar"]',
        'nav',
        '#storybook-explorer-menu',
        '[aria-label*="Sidebar"]',
        '[id*="sidebar"]'
      ];
      
      selectors.forEach(selector => {
        const elements = document.querySelectorAll(selector);
        if (elements.length > 0) {
          console.log(`Found ${elements.length} element(s) with selector: ${selector}`);
          elements.forEach((el, index) => {
            const computed = window.getComputedStyle(el);
            console.log(`  [${index}] Class: ${el.className}`);
            console.log(`  [${index}] Background: ${computed.backgroundColor}`);
            console.log(`  [${index}] Background-image: ${computed.backgroundImage}`);
          });
        }
      });
      
      // Also log body background
      const bodyComputed = window.getComputedStyle(document.body);
      console.log('Body background-color:', bodyComputed.backgroundColor);
      
      console.log('=== END DEBUG ===');
    }, 500);
  }
  
  // Get initial theme
  function getStoredTheme() {
    try {
      const storedGlobals = localStorage.getItem('storybook-globals');
      if (storedGlobals) {
        const parsed = JSON.parse(storedGlobals);
        return parsed.theme || 'light';
      }
    } catch (e) {
      console.error('Error reading theme:', e);
    }
    return 'light';
  }
  
  // Apply initial theme immediately
  const initialTheme = getStoredTheme();
  applyThemeCSS(initialTheme);
  
  // Listen for storage changes
  window.addEventListener('storage', function(e) {
    if (e.key === 'storybook-globals') {
      const theme = getStoredTheme();
      applyThemeCSS(theme);
    }
  });
  
  // Listen for postMessage
  window.addEventListener('message', function(event) {
    if (event.data && event.data.type === 'STORYBOOK_THEME_CHANGED') {
      applyThemeCSS(event.data.theme);
    }
  });
  
  // Poll for theme changes (aggressive backup)
  let lastTheme = initialTheme;
  setInterval(function() {
    const currentTheme = getStoredTheme();
    if (currentTheme !== lastTheme) {
      console.log('Manager-head: Theme changed via polling:', lastTheme, '->', currentTheme);
      lastTheme = currentTheme;
      applyThemeCSS(currentTheme);
    }
  }, 200);
  
  // Also watch for DOM mutations (when sidebar is rendered)
  const observer = new MutationObserver(function() {
    const theme = getStoredTheme();
    if (document.querySelector('[data-side="left"]')) {
      applyThemeCSS(theme);
    }
  });
  
  // Start observing when DOM is ready
  if (document.body) {
    observer.observe(document.body, { childList: true, subtree: true });
  } else {
    document.addEventListener('DOMContentLoaded', function() {
      observer.observe(document.body, { childList: true, subtree: true });
    });
  }
})();
</script>
